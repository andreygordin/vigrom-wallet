# Тестовый проект для Vigrom

## Как запустить

Клонируем себе репозиторий:

```
git clone https://github.com/andreygordin/vigrom-wallet.git
```

В папке проекта запускаем:

```
make init
```

Приложение будет запущено на порту 24891.

По умолчанию в базе будет создано два кошелька: первый долларовый (ID = 241), второй рублевый (ID = 242).

## Как пользоваться

### Метод для изменения баланса

Пример:

```
POST http://localhost:24891/wallets/241/transactions
Content-Type: application/json

{
  "transactionType": "debit",
  "amount": 12000,
  "currency": "USD",
  "reason": "stock"
}
```

### Метод для получения текущего баланса

Пример:

```
GET http://localhost:24891/wallets/241
```

## Комментарии от меня

* Чтобы не усложнять код, я не стал создавать отдельные классы для репозиториев и сущностей. Вместо этого работа с соединением происходит непосредственно из классов-хендлеров (```App\Handler\CreateTransaction\Handler``` и ```App\Handler\WalletDetail\Handler```). Это спорное решение относительно разделения по слоям, плюс первый хендлер получился достаточно раздутым, зато наглядно видно, что там внутри происходит.

* Курсы валют не обновляются — предполагается, что этот функционал реализован отдельно. При миграции в базу просто добавляются две валюты с фиксированными курсами.

* Приложение работает с финансами пользователей, поэтому по-хорошему в каком-то виде должен быть реализован механизм авторизации, чтобы баланс не редактировался кем попало. В задании про это ничего сказано не было, поэтому тут я ничего додумывать не стал.

## SQL запрос

```SQL
SELECT SUM(converted_amount) FROM transaction
    WHERE wallet_id = 241
        AND reason = 'refund'
        AND type = 'credit'
        AND executed_at > (CURRENT_DATE - INTERVAL '7 days');
```

* Из задания не было понятно, требуется ли получить данные для конкретного кошелька или вообще для всех кошельков в системе. Я сделал для конкретного кошелька.

* Здесь сделано допущение, что валюта кошелька постоянна. Я предположил, что в реальном приложении это бы работало именно так — для новой валюты просто создавался бы новый кошелек. Иначе было бы много нюансов с пересчетом курса (в какой момент пересчитывать, как быть с новыми валютами и т. д.).   
